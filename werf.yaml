configVersion: 1
project: "web-client"
---
image: builder
from: node:14-alpine3.11
git:
  - add: /
    to: /app
    stageDependencies:
      install:
        - package.json
        - yarn.lock
      setup: 
        - "**/*"
shell: 
  install: 
    - cd /app
    #- yarn autoclean --init
    #- yarn autoclean --force
    - apk --no-cache --update --virtual build-dependencies add python make g++
    - yarn install
  setup: 
    - cd /app
    - yarn build
---
image: web
from: nginx:stable-alpine
docker:
  WORKDIR: /usr/share/nginx
git:
  - add: /nginx.conf
    to: /etc/nginx/nginx.conf
import:
  - image: builder
    add: /app/dist
    to: /usr/share/nginx/html
    after: setup
